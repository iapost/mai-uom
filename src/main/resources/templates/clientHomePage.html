<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<html>
	<head>
		<style>
            #resultsTable tr:hover {
                background-color: #f1f1f1;
                cursor: pointer;
            }
        </style>
	</head>
	<body onload="showAll();">
		
		Client Home page

		<table>
			<tr>
				<td> Μάρκα: </td>
				<td> <input type='text' id='brand' />
			</tr>
			<tr>
				<td> Μοντέλο: </td>
				<td> <input type='text' id='model' />
			</tr>
			<tr>
				<td> Ελάχιστη Τιμή: </td>
				<td> <input type='number' id='fromPrice' />
			</tr>
			<tr>
				<td> Μέγιστη Τιμή: </td>
				<td> <input type='number' id='toPrice' />
			</tr>
			<tr>
				<td> Ελάχιστος κινητήρα: </td>
				<td> <input type='number' id='fromEngine' />
			</tr>
			<tr>
				<td> Μέγιστος κινητήρας: </td>
				<td> <input type='number' id='toEngine' />
			</tr>
			<tr>
				<td> Καύσιμο: </td>
				<td> <input type='text' id='fuel' />
			</tr>
			<tr>
				<td> Θέσεις: </td>
				<td> <input type='number' id='seats' />
			</tr>
		</table>

		<button name='searchButton' onclick="searchCar();"> Αναζήτηση </button>

		<!--<table border='1' id='resultsTable' style="display:none">-->
		<table border='1' id='resultsTable'>
			<tr>
				<th width='150'> Μάρκα </th>
				<th width='150'> Μοντέλο </th>
				<th width='150'> Καύσιμο </th>
				<th width='150'> Κινητήρας </th>
				<th width='150'> Θέσεις </th>
				<th width='150'> Πληροφορίες </th>
				<th width='150'> Τιμή </th>
				<th width='150'> Ποσότητα </th>
			</tr>
		</table>

	</body>

	<script>
		const token = new URLSearchParams(window.location.search).get('token');
	
		function showAll() {
				var settings = {
					"url": "/client/getCars?token=" + token,
					"method": "GET",
					"timeout": 0
				};
				$.ajax(settings).done(function (response) {
					updateTable(response);
				});
			}

		function searchCar() {
				var settings = {
					"url": "/client/search?token=" + token,
					"method": "POST",
					"timeout": 0,
					"headers": {
						"Content-Type": "application/json"},
					"data": JSON.stringify({
						"brand": document.getElementById("brand").value,
						"model": document.getElementById("model").value,
						"fuel": document.getElementById("fuel").value,
						"seats": document.getElementById("seats").value,
						"fromPrice": document.getElementById("fromPrice").value,
						"toPrice": document.getElementById("toPrice").value,
						"fromEngine": document.getElementById("fromEngine").value,
						"toEngine": document.getElementById("toEngine").value
				  }, (key, value) => {
					  if (value !== '') return value
				  }),
				};
				$.ajax(settings).done(function (response) {
					updateTable(response);
				});
			}

			function updateTable(result) {
				var table = document.getElementById("resultsTable");
				
				var rowCount = table.rows.length;
				for (var i = rowCount - 1; i > 0; i--) {
					table.deleteRow(i);
				}				
				
				for(var k in result) {
					var car = result[k];
					var row = table.insertRow(-1);
					var cell1 = row.insertCell(0);
					var cell2 = row.insertCell(1);
					var cell3 = row.insertCell(2);
					var cell4 = row.insertCell(3);
					var cell5= row.insertCell(4);
					var cell6= row.insertCell(5);
					var cell7= row.insertCell(6)
					var cell8= row.insertCell(7);

					cell1.innerHTML = car.brand;
					cell2.innerHTML = car.model;
					cell3.innerHTML = car.fuel;
					cell4.innerHTML = car.engine;
					cell5.innerHTML = car.seats;
					cell6.innerHTML = car.info;
					cell7.innerHTML = car.price;
					cell8.innerHTML = car.amount;

					row.onclick = (function(car) {
						return function(){
							localStorage.setItem('selectedCar', JSON.stringify(car));
							window.location.href = '/ui/viewCar?token=' + token;
						};
					})(car);
				}
						
				} 
					



	</script>
</html>